
% This LaTeX was auto-generated from MATLAB code.
% To make changes, update the MATLAB code and republish this document.

\documentclass{article}
\usepackage{graphicx}
\usepackage{color}

\sloppy
\definecolor{lightgray}{gray}{0.5}
\setlength{\parindent}{0pt}

\begin{document}

    
    
\subsection*{Contents}

\begin{itemize}
\setlength{\itemsep}{-1ex}
   \item Zachary Kaplan
   \item Parabolic PDE Instance
   \item C.4.1.1 - Dimensionless PDE
   \item C.4.1.2 - Spatial Discretization
   \item C.4.1.3 - Temporal Discretization
   \item C.4.1.4 - ode23 vs. ode23s
   \item Helper Functions
\end{itemize}


\subsection*{Zachary Kaplan}

\begin{par}
Math 440 Computational Lab \#3 4/11/19
\end{par} \vspace{1em}
\begin{verbatim}
%
% An online version of this file can be found published to:
% https://www.overleaf.com/read/zgmxqsryykhj
%
% *NOTE*: To render this file locally, please prepend the following package
%         dependencies to the latex generated by matlab publish:
%
%  \usepackage[margin=1in]{geometry}
%  \usepackage{amsmath}
%  \usepackage{amssymb}
%  \usepackage{microtype}
%  \usepackage{csquotes}
%  \usepackage{bm}
%
\end{verbatim}


\subsection*{Parabolic PDE Instance}

\begin{par}
In this lab, we will consider the PDE describing the diffusion of heat through a metallic rod.
\end{par} \vspace{1em}
\begin{par}
Let $L$ [ $m$ ] denote the length of the rod, $T$ [ $C$ ] denote the temperature of the rod across space and time, $\rho$ [ $kg/m^3$ ] denote the density of the rod, $C_p$ [ $J/(kg \cdot C)$ ] denote the heat capacity of the rod, and $k$ [ $J/(m \cdot s \cdot C)$ ] denote the thermal conductivity of the rod. We will consider this physical system over the 1-D spatial domain $x \,[m] \in \Omega = (0, L)$, and the temporal domain $t\,[s] \in (0, \infty)$. The following PDE then describes the difussion of heat through the rod:
\end{par} \vspace{1em}
\begin{par}
$$
  \rho C_p \frac{\partial T}{\partial t} =
      k \frac{\partial^2 T}{\partial x^2},
      \quad \forall (x, t) \in \Omega \times (0, \infty).
$$
\end{par} \vspace{1em}
\begin{par}
We want to consider this rod where a temperature step-pulse of amplitude $T_0$ occurs at the left endpoint $x = 0$ for time $t \in (0, t_p)$. On the right endpoint, we consider the rod to be isolated and so heat does not flow through where $x = L$. As such, our boundary and initial conditions are:
\end{par} \vspace{1em}
\begin{par}
$$ \begin{gathered}
  T(0, t) =
    \begin{cases} T_0 & 0 \le t \le t_p \\ 0 & t > t_p \end{cases}, \quad
  \frac{\partial T}{\partial x}(L, t) = 0, \\
  T(x, 0) = \begin{cases} T_0 & x = 0 \\ 0 & 0 < x \le L \end{cases}.
\end{gathered} $$
\end{par} \vspace{1em}


\subsection*{C.4.1.1 - Dimensionless PDE}

\begin{par}
In this section, we show that with the proper rescaling of our domain and function $T$, we can represent the above constraints on $T$ with dimensionless equations. Consider dimensionless parameters $\xi$ for space and $\tau$ for time, and the dimensionless function $u$ where
\end{par} \vspace{1em}
\begin{par}
$$ \begin{aligned}x = L\xi, && t = t_p\tau, && T = T_0u\end{aligned}. $$
\end{par} \vspace{1em}
\begin{par}
If we look at the endpoints of our original domain we see that $\xi|_{x = 0} = 0, \xi|_{x = L} = 1,   \tau|_{t = 0} = 0, \tau|_{t \to \infty} \to \infty$. As such, our dimensionless spatial domain becomes $\xi \in \hat\Omega = (0, 1)$, and our dimensionless temporal domain becomes $\tau \in (0, \infty)$. We can then write the partials of $T$ in terms of $u$, $\xi$, and $\tau$ as
\end{par} \vspace{1em}
\begin{par}
$$ \begin{aligned}
  \frac{\partial T}{\partial t} &=
    \frac{\partial T_0u}{\partial \tau}\frac{\partial \tau}{\partial t} =
    \frac{T_0}{t_p} \frac{\partial u}{\partial \tau}, \\
  \frac{\partial T}{\partial x} &=
    \frac{\partial T_0u}{\partial \xi^2} \frac{\partial \xi}{\partial x} =
  \frac{T_0}{L} \frac{\partial u}{\partial \xi}, \\
  \frac{\partial^2 T}{\partial x^2} &=
    \frac{\partial^2 T_0u}{\partial \xi^2}
       \left(\frac{\partial \xi}{\partial x}\right)^2 =
  \frac{T_0}{L^2} \frac{\partial^2 u}{\partial \xi^2}.
\end{aligned} $$
\end{par} \vspace{1em}
\begin{par}
Substituting these values into the original PDE, we find
\end{par} \vspace{1em}
\begin{par}
$$ \begin{gathered}
  \rho C_p \frac{T_0}{t_p} \frac{\partial u}{\partial \tau} =
    k \frac{T_0}{L^2} \frac{\partial^2 u}{\partial \xi^2} \\
  \implies \frac{\partial u}{\partial \tau} =
    a \frac{\partial^2 u}{\partial \xi^2},
  \quad (\xi, \tau) \in \hat\Omega \times (0, \infty),
\end{gathered} $$
\end{par} \vspace{1em}
\begin{par}
where
\end{par} \vspace{1em}
\begin{par}
$$ \begin{gathered}
 a = \frac{k t_p}{\rho C_p L^2} ~\text{has units}~
 \left[ \frac{J/(m \cdot s \cdot C) \cdot s}
        {kg/m^3 \cdot J/(kg \cdot C) \cdot m^2} \right] \equiv
 \left[ \frac{J}{J} \frac{1/m}{1/m^3 \cdot m^2} (1/s \cdot s)
   \frac{1/C}{1/C} \frac{1}{kg \cdot 1/kg} \right] \equiv [1]. \\
 \therefore a~\text{is dimensionless}.
\end{gathered} $$
\end{par} \vspace{1em}
\begin{par}
We can also substitute these equations into the boundary and initial conditions to obtain
\end{par} \vspace{1em}
\begin{par}
$$ \begin{aligned}
  T(0 = x(0), t(\tau)) &=
  \begin{cases}
    T_0 & 0 \le t_p \tau \le t_p \\ 0 & t_p \tau > t_p
  \end{cases} = T_0 u(0, \tau)
  &&\implies u(0, \tau) =
  \begin{cases}
    1 & 0 \le \tau \le 1 \\ 0 & \tau > 1
  \end{cases}, \\
  \frac{\partial T}{\partial x}(L = x(1), t(\tau)) &= 0 =
    \frac{T_0}{L} \frac{\partial u}{\partial \xi}(1, \tau)
  &&\implies \frac{\partial u}{\partial \xi}(1, \tau) = 0, \\
  T(x(\xi), 0 = t(0)) &=
    \begin{cases} T_0 & L\xi = 0 \\ 0 & 0 < L\xi \le L \end{cases} =
  T_0 u(\xi, 0)
  &&\implies u(\xi, 0) =
    \begin{cases} 1 & \xi = 0 \\ 0 & 0 < \xi \le 1
  \end{cases}.
\end{aligned} $$
\end{par} \vspace{1em}
\begin{par}
From this point forward, this lab will only consider this dimensionless problem, fixing the dimensionless parameter $a = 1$.
\end{par} \vspace{1em}


\subsection*{C.4.1.2 - Spatial Discretization}

\begin{par}
We will now discretize the spatial domain of our nondimensional PDE where $\bm{\xi} = \{ \xi_0=0, \xi_1=h, \ldots, \xi_j=jh, \ldots \xi_{N-1}=1,   \xi_N=1+h \}$ are our $N$ grid points with one additional ghost point. If we define $\bm{u}(\tau) = \{u_0(t) \approx u(\xi_0, \tau), u_1(\tau)   \approx u(\xi_1, \tau), \ldots, u_{N-1}(\tau)   \approx u(\xi_{N-1}, \tau), u_N(\tau) \approx u(\xi_N, \tau) \}$, then the following centered finite difference equations hold on the interior of our discrete spatial domain:
\end{par} \vspace{1em}
\begin{par}
$$
  \frac{du_j}{d\tau} = \frac{u_{j-1} - 2u_{j} + u_{j+1}}{h^2} \quad
    \forall j \in \mathbb{Z}_{[1,N-1]}.
$$
\end{par} \vspace{1em}
\begin{par}
Our spatial boundary conditions also follow trivially as either an algebraic equation or as another centered finite diference:
\end{par} \vspace{1em}
\begin{par}
$$ \begin{gathered}
  u_0(\tau) = u(0, \tau) =
    \begin{cases} 1 & 0 \le \tau \le 1 \\ 0 & \tau > 1 \end{cases} \\
  \frac{u_{N} - u_{N-2}}{h} = 0
\end{gathered} $$
\end{par} \vspace{1em}
\begin{par}
Finally, the temportal initial condition translates as
\end{par} \vspace{1em}
\begin{par}
$$ \bm{u}(0) = \{1, 0, 0, \ldots, 0\} $$
\end{par} \vspace{1em}
\begin{par}
since $u(\xi, 0) = 1$ iff $\xi = 0$ and $u(\xi, 0) = 0$ otherwise.
\end{par} \vspace{1em}
\begin{par}
Notice that since $u_0(\tau)$ is given explicitly above, we can substitute $u_0$ out in our overall matrix equation. We can also solve explicitly for $u_N(\tau) = u_{N-2}(\tau)$, allowing for another substitution. With this in mind, we will redefine $\bm{u} = \{u_1(\tau), \ldots, u_{N-1}(\tau)\}$ resulting in
\end{par} \vspace{1em}
\begin{par}
$$
  \frac{d\bm{u}}{d\tau} = A\bm{u} + \bm{b}(\tau), \quad
    \bm{u}(0) = \mathbf{0}
$$
\end{par} \vspace{1em}
\begin{par}
where
\end{par} \vspace{1em}
\begin{par}
$$ \begin{aligned}
  A = \frac{1}{h^2} \begin{pmatrix}
    -2 &  1 &  0 & \cdots &  0 &  0 \\
     1 & -2 &  1 & \cdots &  0 &  0 \\
     0 & \ddots & \ddots & \ddots & & \vdots \\
     \vdots & & \ddots & \ddots & \ddots & 0 \\
     0 & \cdots & 0 & 1 & -2 & 1 \\
     0 & \cdots & 0 & 0 &  2 & -2 \end{pmatrix}
     \in \mathbb{R}^{N-1 \times N-1},
  &&
  \bm{b}(\tau) = \frac{1}{h^2} \begin{pmatrix}
     u_0(\tau) \\ 0 \\ \vdots \\ 0 \end{pmatrix}
     \in \mathbb{R}^{N-1},
  &&
  \bm{u}(0) = \mathbf{0} \in \mathbb{R}^{N-1}.
\end{aligned} $$
\end{par} \vspace{1em}


\subsection*{C.4.1.3 - Temporal Discretization}

\begin{par}
Finally, we discretize $\tau$ using Explicit Euler's Method with a stepsize of $\Delta t$. Let our $\tau$ grid span $[0, \tau_f]$ for some $\tau_f > 0$, and thus we need $M = \tau_f/\Delta t + 1$ grid points. Take $\bm{\tau} = \{\tau_0 = 0, \tau_1 = \Delta t, \ldots   \tau_k = k\Delta t, \ldots, \tau_M = \tau_f\}$ and define $\bm{u}^k \approx \bm{u}(\tau_k)$. We will also define matrix $U$ s.t. $U_{j,k} = u^{k-1}_{j-1}$. Note that our $U$ is the vertical mirror of the text's $U$. We then enforce
\end{par} \vspace{1em}
\begin{par}
$$ \begin{aligned}
 \frac{\bm{u}^{k+1} - \bm{u}^k}{\Delta t} = A\bm{u}^{k} + \bm{b}(\tau_k),
   \quad \forall k \in \mathbb{Z}_{0,M-1},
 &&
 \bm{u}^0 = \bm{0}
\end{aligned} $$
\end{par} \vspace{1em}
\begin{verbatim}
% Picked from later in the lab.
tau_f = 2;

% First, let's try it with N and M on the same order.
N = 10;
M = N;
[xi, tau, U] = mol_ee_solve(N, M, tau_f);
h = xi(2) - xi(1);
dt = tau(2) - tau(1);
figure;
surf(xi, tau, U');
xlabel('\xi', 'Interpreter', 'tex');
ylabel('\tau', 'Interpreter', 'tex');
zlabel('u');
title(sprintf(['Solution where M = O(N)\n' ...
               'h = %f, \\Delta t = %f, \\Delta t / h^2 = %f'], ...
               h, dt, dt/h^2), 'Interpreter', 'tex');

% Now, let's try making M on the order of N^2.
M = 5 * N^2;
[xi, tau, U] = mol_ee_solve(N, M, tau_f);
h = xi(2) - xi(1);
dt = tau(2) - tau(1);
figure;
surf(xi, tau, U', 'LineStyle', ':', 'FaceColor', 'interp');
xlabel('\xi', 'Interpreter', 'tex');
ylabel('\tau', 'Interpreter', 'tex');
zlabel('u');
title(sprintf(['Solution where M = O(N^2)\n' ...
               'h = %f, \\Delta t = %f, \\Delta t / h^2 = %f'], ...
               h, dt, dt/h^2), 'Interpreter', 'tex');
\end{verbatim}
\begin{par}
Notice in the surface plots for this section that when $M = O(N)$ we have unstable behavior in the form of spurious oscillations. The solution behaves wildly near $\tau_f$. Instead, when $M = O(N^2)$ we get smooth, sensible behavior. Since the end with $\xi = 1$ is isolated, we see the heat from the initial pulse cause the entire rod to slowly heat up over $\tau \in [0,1]$. Then we see the heat slowly disipate through the endpoint $\xi = 0$ where the heat is fixed at 0.
\end{par} \vspace{1em}

\includegraphics [width=4in]{lab3_01.eps}

\includegraphics [width=4in]{lab3_02.eps}


\subsection*{C.4.1.4 - ode23 vs. ode23s}

\begin{par}
In this section, we do a case study to help decipher the difference between using ode23 and ode23s.
\end{par} \vspace{1em}
\begin{verbatim}
N = 10;
tau_f = 2;
[xi, tau, U] = mol_ode23_solve(N, tau_f, false);
surf(xi, tau, U', 'LineStyle', ':', 'FaceColor', 'interp');
xlabel('\xi', 'Interpreter', 'tex');
ylabel('\tau', 'Interpreter', 'tex');
zlabel('u');

[xi, tau, U] = mol_ode23_solve(N, tau_f, true);
surf(xi, tau, U', 'FaceColor', 'interp');
xlabel('\xi', 'Interpreter', 'tex');
ylabel('\tau', 'Interpreter', 'tex');
zlabel('u');
\end{verbatim}


\subsection*{Helper Functions}

\begin{par}
As always, helper functions are at the bottom.
\end{par} \vspace{1em}
\begin{verbatim}
function [A, b, xi, h] = mol_descretization(N)
% MOL_DESCRETIZATION returns parameters corresponding to the Method of
%                    Lines discretization of the nondimensional PDE
%                    described above.
%                    Returns
%                      xi - a vector of N xi points on [0, 1]
%                      b  - a function of tau generating a col vector of
%                           dim N-1 (as described above).
%                      A  - a matrix of dim N-1 x N-1 (as described above).
%                      h  - the grid spacing of xi.

% Generate spatial support.
xi = linspace(0, 1, N);  % NOTE: Includes xi_0 but not xi_N.
h = xi(2) - xi(1);

% Generate matrix A of dimensions N-1 x N-1.
dim = N-1;
diags = repmat((1/h^2) * [1 -2 1], dim, 1);   % Diagonals of A (mostly).
A = spdiags(diags, -1:1, dim, dim);           % Form A from diagonals.
A(end, end-1) = 2 * A(end, end-1);            % Update to account for BCs.

% Declare b as a function of tau.
b = @(tau) vertcat(1/h^2 * (tau <= 1), zeros(dim-1, 1));

end

function [xi, tau, U] = mol_ee_solve(N, M, tau_f)
% MOL_EE_SOLVE solves the nondimensional PDE described above with N spatial
%              grid points and M temporal grid points.
%              Uses Method of Lines and Explicit Euler.
%              Evolves until time tau_f.
%              Returns:
%                xi  - a vector of N xi points on [0, 1]
%                tau - a vector of M tau points on [0, tau_f]
%                U   - matrix were U(xi, tau) approximates u(xi, tau).
% See also lab3>mol_descretization.

% Get spatial MOL decretization parameters.
[A, b, xi, ~] = mol_descretization(N);

% Generate temporal support.
tau = linspace(0, tau_f, M);

% For convenience, store delta t.
dt = tau(2) - tau(1);

% For efficiency, we form dt*A + I just once instead of each iteration.
dtApI = dt*A + speye(size(A, 1));

% Allocate space for solution.
U = zeros(length(xi), length(tau));
% The above implicitly sets u^0 to zero (IC).
% We do have to manually account for U(1, :) since we removed it from the
% matrix system (corresponds to u^k_0 in write-up).
U(1, tau <= 1) = 1;

% Iterate over time steps.
% NOTE: k is 1-indexed here instead of 0-indexed like in the write-up.
for k = 1:M-1
    % NOTE: We are indexing rpws 2:end because we removed u_0.
    U(2:end, k+1) = dtApI * U(2:end, k) + dt * b(tau(k));
end
end

function [xi, tau, U] = mol_ode23_solve(N, tau_f, use_stiff)
% MOL_ODE23_SOLVE solves the nondimensional PDE described above with N
%                 spatial grid points.
%                 Uses Method of Lines and ode23[s].
%                 Evolves until time tau_f.
%                 Uses ode23 if ~use_stiff, and ode23s if use_stiff.
%                 Returns:
%                   xi  - a vector of N xi points on [0,1],
%                   tau - a vector of tau points on [0, tau_f].
%                   U   - matrix were U(j, k) approximates u(xi(j),tau(k)).
% See also lab3>mol_descretization.

% Set solver to ode23 or ode23s based on use_stiff.
if use_stiff
    solver = @ode23s;
else
    solver = @ode23;
end

% Get spatial MOL decretization parameters.
[A, b, xi, ~] = mol_descretization(N);

    function dudt = mol_odefun(tau, u)
        % Computes du/dt for a given vector u and tau.
        dudt = A * u + b(tau);
    end

% Our odefun above is only valid for {u_1, ..., u_{N-1}).
dim = N-1;
u0 = zeros(dim, 1);  % First column of solution.
[tau, U] = solver(@mol_odefun, [0 tau_f], u0);
% Since ode23[s] considers tau to be a column vector, and rows of U
% to be for fixed tau, we need to transpose both.
% In our write-up, cols of U are for fixed tau, and tau is a row vec.
tau = tau';
U = U';

% Prepend the row tau <= 1 to account for the eliminated u_0(tau).
U = vertcat(tau <= 1, U);
end
\end{verbatim}



\end{document}
    
